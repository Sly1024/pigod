<commands-panel>
    <pigod-panel>
		<yield to="title">
			Commands
		</yield>
		<yield to="body">
            <table class="sortable table-striped table-sparse commands-table" data-show-columns="true">
                <thead>
                    <tr>
                      <th><a href="#" >Name</a></th>
                      <th><a href="#" >Command</a></th>
                      <th>Execute</th>
                    </tr>
                </thead>
                    <tbody>
                        <tr each={commands}>
                            <td nowrap class="name">{name}</td>
                            <td title="{command}"><div class="truncate">{command}</div></td>
                            <td><button onclick={model.execClick}>Exec</button></td>
                        </tr>
                    </tbody>
            </table>
        </yield>
    </pigod-panel>
    
    <style scoped>
		table {
			width: 100%;
		}
        .truncate {
            width: 275px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .name {
            font-weight: bold;
        }
    </style>
    
    <script type="text/es6arrow">
        start() {
            opts.pubsub.subscribe('commands', data => this.updateProc(data));
        }
        
        stop() {
            opts.pubsub.unsubscribe('commands');
        }
        
        updateProc(data) {
            this.update({ 
                commands : data
            });
        }
        
        execClick(event) {
            var item = event.item;
            if (item && item.id) this.execCommand(item.id, item.name);
        }
                
        execCommand(id, name) {
            if (confirm('Execute ' + name + ' ?')) {
                opts.pubsub.publish('execCommand', { id: id });
            }
        }
    </script>
</commands-panel>